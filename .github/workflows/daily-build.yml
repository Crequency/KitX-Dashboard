name: daily-build

on:
  schedule:
    - cron: '0 6 * * *'

jobs:
  build:

    runs-on: windows-latest

    steps:
    
    - uses: actions/checkout@v3
      with:
        repository: 'Crequency/KitX'
        ref: 'dev=main'
        submodules: 'true'
    
    - name: Init Source Code
      run: |
        ./ToolKits/start.sh dashboard
        ./ToolKits/start.sh reference
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x
      
    - name: Publish
      run: |
        cd "ToolKits"
        cd "KitX.ToolKits.Publisher"
        
        dotnet run
        
        $version = (Get-Item -path "..\..\KitX Publish\kitx-win-x64-single\KitX Dashboard.exe").VersionInfo.ProductVersion
        $date = (Get-Date -Format "yyyy.MM.dd")
        
        cd ../../
        
    - name: Create Release and Upload Release Asset
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ env.version }}
        name: Daily Release ${{ env.date }}
        body: Auto release by Actions.
        draft: false
        prerelease: false
        files: |
          "KitX Publish/*.zip"
